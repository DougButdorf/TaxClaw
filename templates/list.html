{% extends "base.html" %}
{% block content %}
  <div class="row" style="justify-content: space-between; margin-bottom: 14px;">
    <h1 style="margin:0; font-size: 20px;">Documents</h1>
    <div class="row">
      <a href="/review" class="muted">Review queue</a>
      <a href="/upload"><button>Upload</button></a>
    </div>
  </div>

  <div class="card" style="margin-bottom: 14px;">
    <form method="get" action="/documents" class="row" style="align-items: flex-end;">
      <div style="display:flex; flex-direction:column; gap:6px;">
        <label class="muted" for="filer" style="font-size:12px;">Filer</label>
        <input id="filer" name="filer" placeholder="e.g. Doug" value="{{ filters.filer }}" />
      </div>
      <div style="display:flex; flex-direction:column; gap:6px; width: 120px;">
        <label class="muted" for="year" style="font-size:12px;">Tax year</label>
        <input id="year" name="year" placeholder="e.g. 2024" value="{{ filters.year }}" />
      </div>
      <div style="display:flex; flex-direction:column; gap:6px; min-width: 220px;">
        <label class="muted" for="type" style="font-size:12px;">Doc type</label>
        <input id="type" name="type" placeholder="e.g. W-2, 1099-DA" value="{{ filters.type }}" />
      </div>
      <div style="display:flex; flex-direction:column; gap:6px; min-width: 180px;">
        <label class="muted" for="needs_review" style="font-size:12px;">Needs review</label>
        <select id="needs_review" name="needs_review">
          <option value="" {% if filters.needs_review == '' %}selected{% endif %}>Any</option>
          <option value="1" {% if filters.needs_review == '1' %}selected{% endif %}>Yes</option>
          <option value="0" {% if filters.needs_review == '0' %}selected{% endif %}>No</option>
        </select>
      </div>

      <button type="submit">Filter</button>
      <a href="/documents" class="muted">Reset</a>

      <span style="flex:1"></span>
      <a href="/export.wide.csv" class="muted">Export wide CSV</a>
      <a href="/export.long.csv" class="muted">Export long CSV</a>
      <a href="/export.json" class="muted">Export JSON</a>
    </form>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Document</th>
          <th>Type</th>
          <th>Year</th>
          <th>Filer</th>
          <th>Status</th>
          <th>Needs review</th>
          <th>Confidence</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody>
        {% for d in docs %}
          <tr>
            <td>
              <a href="/doc/{{ d.id }}">
                {% if d.display_name %}
                  <div style="font-weight: 700;">{{ d.display_name }}</div>
                  <div class="muted" style="font-size: 12px; margin-top: 2px;">{{ d.id[:8] }}</div>
                {% else %}
                  {{ d.id[:8] }}
                {% endif %}
              </a>
            </td>
            <td>{{ d.doc_type or 'unknown' }}</td>
            <td>{{ d.tax_year or '' }}</td>
            <td>{{ d.filer or '' }}</td>
            <td>
              {% if d.status == 'processed' %}
                <span class="pill ok">processed</span>
              {% elif d.status == 'needs_review' %}
                <span class="pill warn">needs_review</span>
              {% else %}
                <span class="pill">{{ d.status }}</span>
              {% endif %}
            </td>
            <td>
              {% if d.needs_review %}
                <span class="pill warn">yes</span>
              {% else %}
                <span class="pill ok">no</span>
              {% endif %}
            </td>
            <td class="muted">{{ '%.2f'|format(d.overall_confidence or 0) }}</td>
            <td class="muted">{{ d.created_at }}</td>
          </tr>
        {% endfor %}
        {% if docs|length == 0 %}
          <tr><td colspan="8" class="muted">No documents yet.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
