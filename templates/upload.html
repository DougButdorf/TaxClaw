{% extends "base.html" %}
{% block content %}
  <h1 style="margin:0 0 14px 0; font-size: 20px;">Upload</h1>

  <div class="card" id="upload-card">
    <form id="upload-form" method="post" action="/upload" enctype="multipart/form-data" style="max-width: 560px; margin: 0 auto;">
      <div class="muted" style="margin-bottom: 14px; text-align:center;">
        For best results, upload the original PDF.
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap: 10px; padding: 10px 6px;">
        <button id="choose-btn" type="button" style="
          background: rgba(15,23,42,0.9);
          border: 1px solid rgba(148,163,184,0.25);
          color: rgba(226,232,240,0.95);
          padding: 16px 18px;
          border-radius: 14px;
          font-weight: 700;
          font-size: 16px;
          cursor: pointer;
          min-width: min(420px, 100%);
        ">ðŸ“Ž Choose a tax document</button>

        <input id="file-input" type="file" name="file" required style="display:none;" />

        <div id="file-name" class="muted" style="font-size: 13px; min-height: 18px; text-align:center;"></div>

        <div style="height: 2px;"></div>

        <div class="muted" style="font-size: 12px; text-align:center; max-width: 520px; line-height: 1.35;">
          ðŸ’¡ Getting low confidence results? Switch to a cloud model in <a href="/settings">Settings</a> for better accuracy on complex forms.
        </div>

        <button id="upload-btn" type="submit" disabled style="
          opacity: 0.55;
          cursor: not-allowed;
        ">Upload + Extract</button>

        <div class="muted" style="font-size: 11px; text-align:center; margin-top: 2px;">
          ðŸ”’ Your documents stay on your machine. Always. <a href="/settings">Change in Settings â†’</a>
        </div>
      </div>
    </form>
  </div>

  <script>
    (function () {
      const card = document.getElementById('upload-card');
      const chooseBtn = document.getElementById('choose-btn');
      const input = document.getElementById('file-input');
      const fileName = document.getElementById('file-name');
      const uploadBtn = document.getElementById('upload-btn');

      if (!card || !chooseBtn || !input || !uploadBtn) return;

      function setPicked(f) {
        const hasFile = !!f;
        uploadBtn.disabled = !hasFile;
        uploadBtn.style.opacity = hasFile ? '1' : '0.55';
        uploadBtn.style.cursor = hasFile ? 'pointer' : 'not-allowed';
        if (fileName) fileName.textContent = hasFile ? `âœ… ${f.name}` : '';
      }

      // Click -> file picker
      chooseBtn.addEventListener('click', () => input.click());

      // Drag/drop onto the whole card
      function prevent(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      function setActive(active) {
        if (active) {
          card.style.borderColor = 'rgba(96,165,250,0.45)';
          card.style.boxShadow = '0 0 0 3px rgba(96,165,250,0.10)';
        } else {
          card.style.borderColor = '';
          card.style.boxShadow = '';
        }
      }

      ;['dragenter', 'dragover'].forEach(evt => {
        card.addEventListener(evt, (e) => {
          prevent(e);
          setActive(true);
        });
      });

      ;['dragleave', 'drop'].forEach(evt => {
        card.addEventListener(evt, (e) => {
          prevent(e);
          setActive(false);
        });
      });

      card.addEventListener('drop', (e) => {
        const files = e.dataTransfer && e.dataTransfer.files;
        if (!files || files.length === 0) return;
        input.files = files;
        setPicked(files[0]);
      });

      input.addEventListener('change', () => {
        const f = input.files && input.files[0];
        setPicked(f);
      });

      // Initialize
      setPicked(null);
    })();
  </script>
{% endblock %}
